{% extends "base.html" %}
{% load static %}

{% block title %}Edit Product{% endblock %}

{% block content %}
        <div class="page-header">
                    <div class="page-title">
                      <h4>Edit Product</h4>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <form method="post" action="{% url 'products_edit' product.id %}" enctype="multipart/form-data">
    {% csrf_token %}

    {% if errors %}
    <div class="alert alert-danger">
        <ul class="mb-0">
            {% for error in errors %}
            <li>{{ error }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    <div class="row">
        <div class="col-lg-6 col-sm-6 col-12">
            <div class="form-group">
                <label for="id_name">Product Name</label>
                <input
                    type="text"
                    name="name"
                    id="id_name"
                    class="form-control"
                    value="{{ old.name|default_if_none:'' }}"
                    placeholder="Name"
                >
            </div>
        </div>
        <div class="col-lg-6 col-sm-6 col-12">
            <div class="form-group">
                <label for="id_subcategory">Subcategory</label>
                <select
                    name="sub_category_id"
                    id="id_subcategory"
                    class="form-control"
                >
                    <option value="">Select Subcategory</option>
                    {% for subcategory in subcategories %}
                    <option
                        value="{{ subcategory.id }}"
                        {% if old.sub_category_id|stringformat:"s" == subcategory.id|stringformat:"s" %}
                            selected
                        {% endif %}
                    >
                        {{ subcategory.category.name }} - {{ subcategory.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <div class="col-lg-6 col-sm-6 col-12">
            <div class="form-group">
                <label for="id_unit">Unit</label>
                <input
                    type="text"
                    name="unit"
                    id="id_unit"
                    class="form-control"
                    value="{{ old.unit|default_if_none:'' }}"
                    placeholder="e.g. pcs, box, kg"
                >
            </div>
        </div>

        <div class="col-lg-4 col-sm-4 col-12">
            <div class="form-group">
                <label for="id_sku">SKU</label>
                <input
                    type="text"
                    name="sku"
                    id="id_sku"
                    class="form-control"
                    value="{{ old.sku|default_if_none:'' }}"
                    placeholder="SKU"
                >
            </div>
        </div>

        <div class="col-lg-4 col-sm-4 col-12">
            <div class="form-group">
                <label for="id_quantity">Quantity</label>
                <input
                    type="number"
                    name="quantity"
                    id="id_quantity"
                    class="form-control"
                    min="0"
                    value="{{ old.quantity|default_if_none:'0' }}"
                >
            </div>
        </div>

        <div class="col-lg-4 col-sm-4 col-12">
            <div class="form-group">
                <label for="id_status">Status</label>
                <select name="status" id="id_status" class="form-control">
                    <option value="active" {% if old.status == "active" or not old.status %}selected{% endif %}>
                        Active
                    </option>
                    <option value="inactive" {% if old.status == "inactive" %}selected{% endif %}>
                        Inactive
                    </option>
                </select>
            </div>
        </div>

        <div class="col-lg-4 col-sm-4 col-12">
            <div class="form-group">
                <label for="id_price">Price</label>
                <input
                    type="number"
                    name="price"
                    id="id_price"
                    class="form-control"
                    step="0.01"
                    min="0"
                    value="{{ old.price|default_if_none:'' }}"
                >
            </div>
        </div>

        <div class="col-lg-4 col-sm-4 col-12">
            <div class="form-group">
                <label for="id_discount">Discount %</label>
                <input
                    type="number"
                    name="discount_percentage"
                    id="id_discount"
                    class="form-control"
                    step="0.01"
                    min="0"
                    value="{{ old.discount_percentage|default_if_none:'0' }}"
                >
            </div>
        </div>

        <div class="col-lg-12 col-sm-12 col-12">
            <div class="form-group">
                <label for="id_description">Description</label>
                <textarea
                    name="description"
                    id="id_description"
                    class="form-control"
                    rows="3"
                    placeholder="Description (optional)"
                >{{ old.description|default_if_none:'' }}</textarea>
            </div>
        </div>

        <div class="col-lg-12 col-sm-12 col-12">
            <div class="form-group">
                <label for="id_main_image">Main Image</label>
                <input
                    type="file"
                    name="main_image"
                    id="id_main_image"
                    class="form-control"
                    accept="image/*"
                >

                {% if product.main_image %}
                <div style="margin-top:10px;">
                    <img
                        src="{{ product.main_image.url }}"
                        alt="{{ product.name }}"
                        style="width:120px;height:120px;object-fit:cover;border-radius:4px;"
                    >
                </div>
                {% endif %}
            </div>
        </div>

        <div class="col-lg-12">
            <button type="submit" class="btn btn-submit me-2">Update</button>
            <a href="{% url 'products_index' %}" class="btn btn-cancel">Cancel</a>
        </div>
    </div>
</form>

                    </div>
                </div>
{% endblock %}
