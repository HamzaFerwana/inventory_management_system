{# templates/purchases/edit.html #}
{% extends "base.html" %}
{% load static %}

{% block title %}Edit Purchase{% endblock %}

{% block content %}
<div class="page-header">
    <div class="page-title">
        <h4>Purchase</h4>
        <h6>Update Purchase</h6>
    </div>
</div>

{% if messages %}
<div class="mt-2">
    {% for message in messages %}
    <div class="alert alert-{% if message.tags %}{{ message.tags }}{% else %}info{% endif %} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endfor %}
</div>
{% endif %}

{% if errors %}
<div class="alert alert-danger" role="alert">
    <ul class="mb-0">
        {% for error in errors %}
        <li>{{ error }}</li>
        {% endfor %}
    </ul>
</div>
{% endif %}

<div class="card">
    <div class="card-body">
        <form method="post">
            {% csrf_token %}
            <div class="row">

                <div class="col-lg-4 col-sm-6 col-12">
                    <div class="form-group">
                        <label>Supplier Name <span class="text-danger">*</span></label>
                        <input type="text"
                               class="form-control"
                               name="supplier_name"
                               list="suppliers_list"
                               value="{{ old.supplier_name|default_if_none:'' }}"
                               required>
                        <datalist id="suppliers_list">
                            {% for supplier in suppliers %}
                            <option value="{{ supplier.name }}"></option>
                            {% endfor %}
                        </datalist>
                    </div>
                </div>

                <div class="col-lg-4 col-sm-6 col-12">
                    <div class="form-group">
                        <label>Product Name <span class="text-danger">*</span></label>
                        <input type="text"
                               class="form-control"
                               name="product_name"
                               list="products_list"
                               value="{{ old.product_name|default_if_none:'' }}"
                               required>
                        <datalist id="products_list">
                            {% for product in products %}
                            <option value="{{ product.name }}"></option>
                            {% endfor %}
                        </datalist>
                    </div>
                </div>

                <div class="col-lg-4 col-sm-6 col-12">
                    <div class="form-group">
                        <label>Purchase Date <span class="text-danger">*</span></label>
                        <input type="date"
                               class="form-control"
                               name="purchase_date"
                               value="{{ old.purchase_date|date:'Y-m-d' }}"
                               required>
                    </div>
                </div>

                <div class="col-lg-3 col-sm-6 col-12">
                    <div class="form-group">
                        <label>Quantity <span class="text-danger">*</span></label>
                        <input type="number"
                               min="0"
                               class="form-control"
                               name="quantity"
                               value="{{ old.quantity|default_if_none:'' }}"
                               required>
                    </div>
                </div>

                <div class="col-lg-3 col-sm-6 col-12">
                    <div class="form-group">
                        <label>Unit Price <span class="text-danger">*</span></label>
                        <input type="number"
                               step="0.01"
                               min="0"
                               class="form-control"
                               name="unit_price"
                               value="{{ old.unit_price|default_if_none:'' }}"
                               required>
                    </div>
                </div>

                <div class="col-lg-3 col-sm-6 col-12">
                    <div class="form-group">
                        <label>Discount (%) <span class="text-danger">*</span></label>
                        <input type="number"
                               step="0.01"
                               min="0"
                               max="100"
                               class="form-control"
                               name="discount"
                               value="{{ old.discount|default_if_none:'0' }}"
                               required>
                    </div>
                </div>

                <div class="col-lg-3 col-sm-6 col-12">
                    <div class="form-group">
                        <label>Tax Rate (%) <span class="text-danger">*</span></label>
                        <input type="number"
                               step="0.01"
                               min="0"
                               max="100"
                               class="form-control"
                               name="tax_rate"
                               value="{{ old.tax_rate|default_if_none:'0' }}"
                               required>
                    </div>
                </div>

                <div class="col-lg-4 col-sm-6 col-12">
                    <div class="form-group">
                        <label>Status <span class="text-danger">*</span></label>
                        <select class="form-control" name="status" required>
                            <option value="pending"  {% if old.status == 'pending' %}selected{% endif %}>Pending</option>
                            <option value="ordered"  {% if old.status == 'ordered' %}selected{% endif %}>Ordered</option>
                            <option value="received" {% if old.status == 'received' %}selected{% endif %}>Received</option>
                            <option value="cancelled"{% if old.status == 'cancelled' %}selected{% endif %}>Cancelled</option>
                        </select>
                    </div>
                </div>

                <div class="col-lg-4 col-sm-6 col-12">
                    <div class="form-group">
                        <label>Paid Amount <span class="text-danger">*</span></label>
                        <input type="number"
                               step="0.01"
                               min="0"
                               class="form-control"
                               name="paid_amount"
                               value="{{ old.paid_amount|default_if_none:'0' }}"
                               required>
                    </div>
                </div>

                <div class="col-lg-12 col-sm-12 col-12">
                    <div class="form-group">
                        <label>Description</label>
                        <textarea class="form-control"
                                  name="description"
                                  rows="3"
                                  placeholder="Optional notes">{{ old.description|default_if_none:'' }}</textarea>
                    </div>
                </div>

                <div class="col-lg-12">
                    <button type="submit" class="btn btn-submit me-2">Update</button>
                    <a href="{% url 'purchases_index' %}" class="btn btn-cancel">Cancel</a>
                </div>

            </div>
        </form>
    </div>
</div>
{% endblock %}
